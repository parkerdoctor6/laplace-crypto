# 噪声区域交易策略

[Download here](https://github.com/parkerdoctor6/laplace-crypto/releases)

## 项目简介

本项目实现了一个基于价格波动噪声区域的加密货币交易策略。该策略通过观察历史数据的波动特性，构建动态的价格上下边界，当价格突破这些边界时产生交易信号。

## 功能特点

- 基于历史波动率动态计算上下边界
- 支持可配置的交易时段
- 内置追踪止损机制
- 考虑交易手续费和滑点
- 每日交易次数限制
- 详细的回测结果分析
- 全仓资金管理
- 资金曲线跟踪和回撤分析
- 直观的图表可视化
- 高效的大数据集处理优化

## 安装依赖

```bash
pip install pandas numpy matplotlib
```

## 使用方法

### 基本用法

```bash
python noise_region_strategy_backtest.py
```

### 配置参数

所有参数现在直接在代码文件顶部的`CONFIG`字典中配置：

```python
CONFIG = {
    "data_file": None,  # 设置为None会自动查找最新的BTC数据文件
    "source": "okx",
    "lookback_days": 2,  # 用于计算波动率的历史数据天数
    "k1": 1.2,  # 上边界乘数
    "k2": 1.2,  # 下边界乘数
    "trade_start_time": time(0, 0),  # 比特币24小时交易，可以自定义交易时段
    "trade_end_time": time(23, 59),
    "max_trades_per_day": 3,  # 每日最大交易次数
    "commission_rate": 0.0005,  # 手续费率（0.05%）
    "slippage": 0.0003,  # 滑点（0.03%）
    "start_date": "2025-05-10",  # 只处理从这个日期开始的数据
    "initial_balance": 100000  # 初始资金金额
}

### 数据格式要求

输入数据必须是CSV格式，并且包含以下列：
- `timestamp`：时间戳
- `open`：开盘价
- `high`：最高价
- `low`：最低价
- `close`：收盘价

## 性能优化

本项目包含以下性能优化，使其能够高效处理大型数据集：

1. **缓存机制**：
   - sigma计算结果缓存，避免重复计算
   - 开盘价缓存，减少数据查询次数

2. **批处理优化**：
   - 时间点批量处理，减少内存占用
   - 每批次强制执行垃圾回收

3. **详细进度日志**：
   - 显示计算边界的总体进度
   - 批处理时显示完成百分比和耗时

4. **向量化操作**：
   - 使用pandas和numpy的向量化操作提高计算效率

## 输出结果

回测运行后会在`./output`目录下生成以下文件：

- `backtest_results.csv`：详细的回测结果数据
- `trades.csv`：所有交易记录
- `performance.csv`：性能指标总结
- `noise_region_backtest.png`：某一交易日的策略行为可视化
- `cumulative_pnl.png`：累计盈亏曲线
- `balance_history.png`：账户资金曲线（含最大回撤标记）

## 性能指标

回测结果包含以下性能指标：

- 总交易次数
- 盈利交易次数和亏损交易次数
- 胜率
- 总盈亏
- 平均每笔交易盈亏
- 最大回撤
- 夏普比率
- 初始资金和最终资金
- 总收益率（百分比）

## 策略逻辑

1. 基于历史同时段价格变动计算波动率sigma
2. 使用当日开盘价和前日收盘价计算上下边界参考价
3. 价格突破上边界时做多，突破下边界时做空
4. 使用动态追踪止损机制管理风险
5. 交易时段结束时强制平仓所有持仓

## 数据过滤

您可以通过`CONFIG`中的`start_date`参数设置回测的起始日期，系统将只处理该日期及之后的数据。这有助于聚焦分析特定时间段，或者减少数据量加快处理速度。

## 注意事项

- 建议使用至少3天以上的数据进行回测，前面的天数用于计算历史波动率
- 策略参数需要根据不同市场和时间周期进行优化
- 回测结果仅供参考，实际交易可能受到更多因素影响
- 处理大型数据集时，请确保有足够的系统内存
